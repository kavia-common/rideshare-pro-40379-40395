{"is_source_file": true, "format": "JavaScript (Node.js)", "description": "Backend API server implementation for a rideshare application. The code sets up an Express server with routes for user registration, login, trip management, and health check. It integrates with WebSocket via socket.io for real-time updates, and uses MongoDB through Mongoose models. The server handles JWT authentication, driver trip simulation, and OSRM routing for distance calculation.", "external_files": ["./utils/db.js", "./models/index.js", "./models/user.js", "./models/driver.js", "./models/trip.js"], "external_methods": ["connectMongo", "registerModels"], "published": ["getJwtSecret", "authMiddleware", "osrmRoute", "simulateDriverMovement"], "classes": [{"name": "Server as SocketIOServer", "description": "Socket.io server class used for WebSocket communication"}], "methods": [{"name": "getJwtSecret()", "description": "Retrieves JWT secret from environment variables or defaults to a development secret.", "scope": "", "scopeKind": ""}, {"name": "authMiddleware(req, res, next)", "description": "Express middleware to authenticate requests via JWT token in Authorization header.", "scope": "", "scopeKind": ""}, {"name": "toPoint(lat, lng)", "description": "Converts latitude and longitude to GeoJSON Point format.", "scope": "", "scopeKind": ""}, {"name": "osrmRoute(origin, destination)", "description": "Queries OSRM API to get route details including distance, duration, and polyline.", "scope": "", "scopeKind": ""}, {"name": "simulateDriverMovement(ioInstance, tripId, driverId, pickup, destination)", "description": "Simulates movement of driver from current location to pickup and destination, emitting updates via WebSocket.", "scope": "", "scopeKind": ""}], "calls": ["mongoose.model", "connectMongo", "registerModels", "jwt.verify", "jwt.sign", "bcrypt.hash", "bcrypt.compare", "mongoose.findOne", "mongoose.create", "mongoose.updateOne", "mongoose.findById", "mongoose.findOne", "mongoose.save", "fetch", "io.to().emit", "setTimeout"], "search-terms": ["socket.io configuration", "OSRM routing", "driver simulation", "trip creation", "WebSocket room management", "JWT middleware", "MongoDB models", "Express backend server"], "state": 2, "file_id": 32, "knowledge_revision": 90, "git_revision": "d5ceb98b26b05bf792e4c2976f52585d5215c4f3", "revision_history": [{"72": ""}, {"88": "5236db1cdf23d98d55cfdc468f5ebd29fd6a1d93"}, {"90": "d5ceb98b26b05bf792e4c2976f52585d5215c4f3"}], "ctags": [{"_type": "tag", "name": "Driver", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^const Driver = mongoose.model('Driver');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "Trip", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^const Trip = mongoose.model('Trip');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "User", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^const User = mongoose.model('User');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "allowedOrigin", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^const allowedOrigin = process.env.REACT_APP_FRONTEND_URL || process.env.REACT_APP_BACKEND_URL ||/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^const app = express();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authMiddleware", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^function authMiddleware(req, res, next) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, res, next)"}, {"_type": "tag", "name": "getJwtSecret", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^function getJwtSecret() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "io", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^const io = new SocketIOServer(server, {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "lat", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^    const start = { lat: driver.currentLocation.coordinates[1], lng: driver.currentLocation.coor/", "language": "JavaScript", "kind": "property", "scope": "simulateDriverMovement.start", "scopeKind": "class"}, {"_type": "tag", "name": "lng", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^    const start = { lat: driver.currentLocation.coordinates[1], lng: driver.currentLocation.coor/", "language": "JavaScript", "kind": "property", "scope": "simulateDriverMovement.start", "scopeKind": "class"}, {"_type": "tag", "name": "osrmRoute", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^async function osrmRoute(origin, destination) {$/", "language": "JavaScript", "kind": "function", "signature": "(origin, destination)"}, {"_type": "tag", "name": "port", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^const port = Number(process.env.PORT || process.env.REACT_APP_PORT || 4000);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "server", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^const server = http.createServer(app);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "simulateDriverMovement", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^async function simulateDriverMovement(ioInstance, tripId, driverId, pickup, destination) {$/", "language": "JavaScript", "kind": "function", "signature": "(ioInstance, tripId, driverId, pickup, destination)"}, {"_type": "tag", "name": "start", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^    const start = { lat: driver.currentLocation.coordinates[1], lng: driver.currentLocation.coor/", "language": "JavaScript", "kind": "class", "scope": "simulateDriverMovement", "scopeKind": "class"}, {"_type": "tag", "name": "toPoint", "path": "/home/kavia/workspace/code-generation/rideshare-pro-40379-40395/backend_api_server/src/server.js", "pattern": "/^function toPoint(lat, lng) {$/", "language": "JavaScript", "kind": "function", "signature": "(lat, lng)"}], "hash": "0ea18ca758b36ef7385af1d5bcb9461d", "format-version": 4, "code-base-name": "mobile_app_frontend", "filename": "backend_api_server/src/server.js", "fields": [{"name": "const start = { lat: driver.currentLocation.coordinates[1], lng: driver.currentLocation.coor/", "scope": "simulateDriverMovement.start", "scopeKind": "class", "description": "unavailable"}]}